{% extends "share/dashboard.html" %} {% block title %}Financial Reports{%
endblock %} {% block card_header %}bg-info{% endblock %} {% block card_title
%}Financial Reports{% endblock %} {% block card_content %}

<!-- Generate New Report Button -->
<div class="d-flex justify-content-between align-items-center mb-3">
  <!-- Report Type Dropdown -->
  <div>
    <label for="reportType" class="me-2 fw-bold">Select Report Type:</label>
    <select id="reportType" class="form-select w-auto d-inline">
      <option value="all">All Reports</option>
      <option value="fee_collection">Fee Collection</option>
      <option value="financial_health">Financial Health</option>
      <option value="overdue_payment">Overdue Payments</option>
    </select>
  </div>

  <a href="{{ url_for('accountant.generate_report') }}" class="btn btn-success">
    <i class="fas fa-plus"></i> Generate New Report
  </a>
</div>

<!-- Table to Display Reports -->
<div class="table-responsive">
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Report Name</th>
        <th>Report Type</th>
        <th>Generation Date</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="reportTableBody">
      {% for report in reports %}
      <tr data-type="{{ report.report_type }}">
        <td>{{ report.report_id }}</td>
        <td class="text-capitalize">
          {{ report.report_type.replace('_', ' ') }}
        </td>
        <td>{{ report.date.strftime('%Y-%m-%d %H:%M:%S') }}</td>
        <!-- Added timestamp format here -->
        <td>
          <a
            href="{{ url_for('accountant.view_report', report_id=report.report_id) }}"
            class="btn btn-primary btn-sm"
            target="_blank"
          >
            View PDF
          </a>
          <form
            action="{{ url_for('accountant.delete_report', report_id=report.report_id) }}"
            method="POST"
            class="d-inline"
          >
            <button type="submit" class="btn btn-danger btn-sm delete-btn">
              Remove
            </button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% if not reports %}
<p class="text-center text-muted">No reports available.</p>
{% endif %}

<!-- JavaScript for Filtering Reports & Confirmation -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const reportTypeDropdown = document.getElementById("reportType");
    const reportTableBody = document.getElementById("reportTableBody").children;

    // Filter reports based on selected type
    reportTypeDropdown.addEventListener("change", function () {
      const selectedType = this.value;

      Array.from(reportTableBody).forEach((row) => {
        const reportType = row.getAttribute("data-type");

        if (selectedType === "all" || reportType === selectedType) {
          row.style.display = "";
        } else {
          row.style.display = "none";
        }
      });
    });

    // Delete Confirmation
    document.querySelectorAll(".delete-btn").forEach((button) => {
      button.addEventListener("click", function (event) {
        event.preventDefault();
        if (confirm("Are you sure you want to delete this report?")) {
          this.closest("form").submit();
        }
      });
    });
  });
</script>

{% endblock %}
