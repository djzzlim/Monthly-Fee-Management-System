{% extends "share/dashboard.html" %} {% block title %}Invoices{% endblock %} {%
block card_header %}bg-info{% endblock %} {% block card_title %}Generated
Invoices{% endblock %} {% block card_content %}

<!-- Top Section: Date Range Filter & Create Button -->
<div class="d-flex justify-content-between align-items-center mb-3">
  <form method="POST" class="d-flex gap-2">
    <label class="fw-bold" for="start_date">Start Date:</label>
    <input
      type="date"
      id="start_date"
      name="start_date"
      class="form-control w-auto"
      value="{{ start_date }}"
      required
    />

    <label class="fw-bold" for="end_date">End Date:</label>
    <input
      type="date"
      id="end_date"
      name="end_date"
      class="form-control w-auto"
      value="{{ end_date }}"
      required
    />

    <button type="submit" class="btn btn-primary">Filter</button>
  </form>

  <a href="{{ url_for('accountant.create_invoice') }}" class="btn btn-success">
    <i class="fas fa-plus"></i> Create New Invoice
  </a>
</div>

<!-- Table of Invoices -->
<div class="table-responsive">
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Invoice Name</th>
        <th>Generation Date</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      {% for invoice in invoices %}
      <tr>
        <td>{{ invoice.invoice_id }}</td>
        <td>{{ invoice.date.strftime('%Y-%m-%d') }}</td>
        <td>
          <a
            href="{{ url_for('accountant.view_invoice', invoice_id=invoice.invoice_id) }}"
            class="btn btn-primary btn-sm"
            target="_blank"
          >
            View PDF
          </a>
          <form
            action="{{ url_for('accountant.delete_invoice', invoice_id=invoice.invoice_id) }}"
            method="POST"
            class="d-inline"
          >
            <button type="submit" class="btn btn-danger btn-sm delete-btn">
              Remove
            </button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% if not invoices %}
<p class="text-center text-muted">
  No invoices available for the selected date range.
</p>
{% endif %}

<!-- Delete Confirmation -->
<script>
  document.querySelectorAll(".delete-btn").forEach((button) => {
    button.addEventListener("click", function (event) {
      event.preventDefault();
      if (confirm("Are you sure you want to delete this invoice?")) {
        this.closest("form").submit();
      }
    });
  });
</script>

{% endblock %}
