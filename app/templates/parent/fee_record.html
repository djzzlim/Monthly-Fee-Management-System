{% extends "share/dashboard.html" %}

{% block title %}
  Fee Record
{% endblock %}

{% block card_header %}
  bg-success
{% endblock %}

{% block card_title %}
  Fee Record
{% endblock %}

{% block card_content %}
  <p>Viewing fee record for: <strong>{{ selected_child.first_name }} {{ selected_child.last_name }}</strong></p>

  <table class="table table-bordered table-striped">
    <thead>
      <tr>
        <th>#</th>
        <th>Date Assigned</th>
        <th>Invoice ID</th>
        <th>Fee Assignment</th>
        <th>Due Date</th>
        <th>Amount (RM)</th>
        <th>Status</th>
        <th>Penalty</th>
        <th>Total Amount (RM)</th>
        <th>Print Invoice</th>
      </tr>
    </thead>
    <tbody>
      {% for record in fee_records %}
      <tr>
        <td>{{ loop.index }}</td>
        <td>{{ record.date_assigned }}</td>
        <td>invoice_{{ record.fee_record_id }}</td>
        <td>{{ record.assignment.structure.description }}</td>
        <td>{{ record.due_date }}</td>
        <td>RM {{ record.amount_due }}</td>
        <td>{{ record.status.status_name if record.status else "Unknown" }}</td>
        <td>RM {{ record.penalty if record.penalty else 0 }}</td>
        <td>RM {{ record.amount_due + (record.penalty if record.penalty else 0) }}</td>
        <td>
          {% set invoice_path = url_for('parent.download_invoice', fee_record_id=record.fee_record_id) %}
          <a href="{{ invoice_path }}" class="btn btn-primary" target="_blank">Print Invoice</a>
        </td>
        
      </tr>
      {% endfor %}
    </tbody>
  </table>

  {% if not fee_records %}
    <p class="alert alert-info">No Fee Records</p>
  {% endif %}

  <a href="{{ url_for('parent.dashboard') }}" class="btn btn-secondary">Back to Dashboard</a>

{% endblock %}
