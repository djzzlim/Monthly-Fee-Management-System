{% extends "share/dashboard.html" %} {% block title %}Edit User Details{% endblock %}
{% block card_header %}bg-danger{% endblock %} {% block card_title %}Edit User Details{% endblock %} {% block card_content %}

<form action="{{ url_for('admin.edit_user', user_id=user.id) }}" method="post">
    <div class="mb-3">
        <label for="first_name" class="form-label">First Name</label>
        <input type="text" class="form-control" id="first_name" name="first_name" value="{{ user.first_name }}" required>
    </div>
    
    <div class="mb-3">
        <label for="last_name" class="form-label">Last Name</label>
        <input type="text" class="form-control" id="last_name" name="last_name" value="{{ user.last_name }}" required>
    </div>

    <div class="mb-3">
        <label for="email" class="form-label">Email</label>
        <input type="email" class="form-control" id="email" name="email" value="{{ user.email }}" required>
    </div>

    <!-- Date of Birth Field -->
    <div class="mb-3">
        <label for="date_of_birth" class="form-label">Date of Birth</label>
        <input type="date" class="form-control" id="date_of_birth" name="date_of_birth" value="{{ user.date_of_birth|default('') }}" required>
    </div>

    <div class="mb-3">
        <label for="role" class="form-label">Role</label>
        <select class="form-select" id="role" name="role_id" required onchange="togglePasswordField()">
            {% for role in roles %}
                <option value="{{ role.id }}" {% if role.id == user.role_id %}selected{% endif %}>
                    {{ role.role_name }}
                </option>
            {% endfor %}
        </select>
    </div>

    <!-- Password field with ID for toggling visibility -->
    <div class="mb-3" id="password-field">
        <label for="password" class="form-label">New Password</label>
        <input type="password" class="form-control" id="password" name="password" placeholder="Enter new password">
        <small class="form-text text-muted">Leave blank to keep the current password.</small>
    </div>

    <button type="submit" class="btn btn-primary">Save Changes</button>
    <a href="{{ url_for('admin.manage_users') }}" class="btn btn-secondary">Cancel</a>
</form>

<script>
    function togglePasswordField() {
    const roleSelect = document.getElementById('role');
    const passwordField = document.getElementById('password-field');
    const passwordInput = document.getElementById('password');
    const currentRoleId = "{{ user.role_id }}"; // Get the current role ID from the server

    // If the selected role is '5' (e.g., Student), hide the password field
    if (roleSelect.value === '5') {
        passwordField.style.display = 'none';
        passwordInput.removeAttribute("required"); // Ensure password is not required
    }
    // If the current role is '5' (e.g., Student) and changing to a different role
    else if (currentRoleId === '5' && roleSelect.value !== '5') {
        passwordField.style.display = 'block';
        passwordInput.setAttribute("required", "required"); // Make password required
    }
    // For other cases, show the password field but donâ€™t make it required
    else {
        passwordField.style.display = 'block';
        passwordInput.removeAttribute("required"); // Ensure password is optional
    }
}

    // Initialize function to set the field display on page load
    document.addEventListener("DOMContentLoaded", togglePasswordField);
</script>

{% endblock %}

